From 38de34a597188d88c213f6ad0889196cae3761ce Mon Sep 17 00:00:00 2001
From: Dimitar Dimitrov <dimitar@dinux.eu>
Date: Fri, 22 Jun 2018 06:35:42 +0300
Subject: [PATCH 12/13] Clobber test

Signed-off-by: Dimitar Dimitrov <dimitar@dinux.eu>
---
 gcc/testsuite/gcc.target/pru/clobber-sp.c | 45 +++++++++++++++++++++++++++++++
 1 file changed, 45 insertions(+)
 create mode 100644 gcc/testsuite/gcc.target/pru/clobber-sp.c

diff --git a/gcc/testsuite/gcc.target/pru/clobber-sp.c b/gcc/testsuite/gcc.target/pru/clobber-sp.c
new file mode 100644
index 00000000000..66f975f185f
--- /dev/null
+++ b/gcc/testsuite/gcc.target/pru/clobber-sp.c
@@ -0,0 +1,45 @@
+/* Test inline ASM clobber for SP register */
+
+/* { dg-do run } */
+/* { dg-options "-O1" } */
+
+/* -O1 in the options is significant.  */
+
+extern void abort (void);
+
+int
+test1 (void)
+{
+  int res;
+
+#ifdef __PRU__
+  asm volatile(
+	       "ldi	%[res], 101		\n\t"
+	       "ldi32	sp, 0xaa55aa55		\n\t"
+	       : [res] "=r" (res)
+	       :
+	       : "sp");
+#else
+  asm volatile(
+	       "movl	$101, %[res]		\n\t"
+	       "movq	$0xaa55aa55, %%rsp	\n\t"
+	       "movq	$0xaa55aa55, %%rbp	\n\t"
+	       : [res] "=r" (res)
+	       :
+	       : "%rsp", "%rbp");
+#endif
+
+  return res;
+}
+
+#if 1
+int
+main (int argc, char** argv)
+{
+  if (test1 () != 101)
+    abort();
+
+  return 0;
+}
+
+#endif
-- 
2.11.0

